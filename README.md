# Hardening-Ansible-Terraform

### Task:
  - Create and run a script (Ansible playbook) to harden user's passwords by rejecting the ones that contain a username.
    
    Enforce this rule for ‘root’ as well.
  - Write a report and proof of workability (screenshots)
  - Target platform: any Linux-based distribution
  
    Tools: 
      - Ansible
      - PAM module      


### Hi there! ###
In this repo u can find some Ansible role-structured playbook for password hardening and Terraform code to use locally.
Some additional rules were added for passwords.

### Workdir structure ###
  
Terraform is being used to deploy several vms via _for_each_ constructure.

Terraform generates Ansible _hosts.ini_ file for being used in future playbooks executions.

  ```
${root-dir}/
|  
├─ansible/
|   ├────hardener.yml---> Main playbook to execute which contains underlaying role
|   ├────inventory/
|   |      └── hosts.ini--->(generated by Terraform from VM's IPs)
|   └────roles/
|          └── password-hardener/
|                ├──tasks/
|                |    └──main.yml---> tasks to install required packages + push the config 
|                ├──defaults
|                │    └──main.yml
|                ├──vars
|                |    └──main.yml
|                └──files
|                     └──passwd
├─templates/
|    └──ansible-hosts.tpl
├─main.tf---> TF code where VM deploy options are defined
├─outputs.tf---> TF code to show VM's IP's
├─providers.tf---> TF code with required providers + backed configuration
├─variables.tf---> TF code with input variables for root module
└─hardener.yml--->(for additional rules to harden passwords)
 ```
  

### How to use ###
Files need to be created additinaly:
  - _cloud_init.cfg_ (i'm using cloud_init to push public key to VMs, you can check how to configure it [here](https://cloudinit.readthedocs.io/en/latest/topics/examples.html))
  - _terraform.tfvars_ (with your own variables values)
  - right template(u can see an example in this repo) for performing _hosts.ini_ generation
  > Note! U can use input variables list from _variables.terraform_ file
  
>About TF backend: if u feel unconfident using TF backend u can skip backend block and use terraform with tfstate locally

### How to use ###
To download Terraform provider modules:
```
terraform init
```
To plan infrastructure creation:
```
terraform plan
```
To apply changes:
```
terraform apply
```
Then cd to ansible dir to work with Ansible with following command:
```
cd ansible
```
Execute the playbook (by name):
  - _hardener.yml_

by running following command
```
ansible-playbook -i inventory/hosts.ini hardener.yml
```

>You can skip adding _-u $username_ step if username is defined in role's variable (see .../roles/$role-name/vars/main.yml content)

>Host checking is disabled by role's defaults (see .../roles/$role-name/defaults/main.yml content)

To connect to VMs via ssh:
```
ssh -i <path-to-private-key> <remote-user>@<ip-addr>
```

### Screenshots:
1. Terraform execution outputs:

![image](https://user-images.githubusercontent.com/109740456/212538621-428ea522-1f95-4091-a3d3-78426619be38.png)

2. Ansible execution outouts:

![image](https://user-images.githubusercontent.com/109740456/212538674-9423372e-6be7-44db-b995-cefa339225f1.png)

3. Making sure the config is deployed:

![image](https://user-images.githubusercontent.com/109740456/212538787-95a3d32b-f464-42ff-9607-9f0c587613a5.png)

4. Attempt to change password for root user:

![image](https://user-images.githubusercontent.com/109740456/212538731-41a021a3-87b1-447f-8eb8-e397c107548f.png)

5. Attempt to change password for regular user:

![image](https://user-images.githubusercontent.com/109740456/212538778-1f1554e7-2c72-4e55-a0db-8f28350ee58b.png)

### Useful links: ###
[About Ansible](https://docs.ansible.com/ansible_community.html)

[About pam_pwquality](https://manpages.ubuntu.com/manpages/jammy/man8/pam_pwquality.8.html)

[About Terraform](https://developer.hashicorp.com/terraform/docs)

[Libvirt privider](https://registry.terraform.io/providers/dmacvicar/libvirt/latest/docs)

[About Libvirt](https://ubuntu.com/server/docs/virtualization-libvirt)
 
